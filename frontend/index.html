<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyBuilding — Объекты</title>
    <link rel="icon" href="assets/design_key.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="budget.css">
    <link rel="stylesheet" href="expense.css">
    <link rel="stylesheet" href="analysis.css">
    <link rel="stylesheet" href="income_modal.css">
    <link rel="stylesheet" href="income_table_buttons.css">
</head>

<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img id="sidebar-logo" src="assets/design_key.png" alt="logo" style="display:none;" />
            <span>MYBUILDPRO</span>
            <button id="add-object">+</button>
        </div>
        <ul id="object-list" class="object-list"></ul>
    </div>
    <div class="main-content">
        <!-- ====== MS OFFICE STYLE RIBBON ====== -->
        
        <!-- Title Bar (Quick Access Toolbar) -->
        <div class="office-title-bar">
            <div class="title-bar-left">
                <button id="qat-save" class="qat-btn" title="Сохранить">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                </button>
                <button id="qat-undo" class="qat-btn" title="Отменить">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>
                </button>
                <button id="qat-redo" class="qat-btn" title="Повторить">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13"/></svg>
                </button>
                <button id="qat-print" class="qat-btn" title="Печать">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                </button>
            </div>
            <div class="title-bar-center">
                <div class="object-select-wrap">
                    <button id="object-select" class="object-select-btn title-bar-select">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                        <span id="selected-object-name">Выбор объекта</span>
                        <span class="caret">▾</span>
                    </button>
                    <div id="object-dropdown" class="object-dropdown" style="display:none;"></div>
                </div>
            </div>
            <div class="title-bar-right">
                <div class="search-box">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                    <input id="global-search" type="search" placeholder="Поиск..." />
                </div>
            </div>
        </div>

        <!-- Ribbon Tabs -->
        <div class="office-ribbon">
            <div class="ribbon-tabs">
                <button class="ribbon-tab active" data-ribbon="analysis">Аналитика</button>
                <button class="ribbon-tab" data-ribbon="budget">Смета</button>
                <button class="ribbon-tab" data-ribbon="finances">Финансы</button>
                <button class="ribbon-tab" data-ribbon="gpr">ГПР</button>
                <button class="ribbon-tab" data-ribbon="smr">СМР</button>
                <button class="ribbon-tab" data-ribbon="settings">Настройки</button>
            </div>
            
            <!-- Ribbon Panels -->
            <div class="ribbon-content">
                <!-- Analysis Ribbon Panel -->
                <div class="ribbon-panel active" data-panel="analysis">
                    <div class="ribbon-group">
                        <div class="ribbon-group-content row">
                            <button id="ribbon-object-data" class="ribbon-btn analysis-view active" data-view="object-data">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                                <span>Данные<br>объекта</span>
                            </button>
                        </div>
                        <span class="ribbon-group-label">Объект</span>
                    </div>
                    <div class="ribbon-separator"></div>
                    <div class="ribbon-group">
                        <div class="ribbon-group-content row">
                            <button id="ribbon-finance-analytics" class="ribbon-btn analysis-view" data-view="finance-analytics">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>
                                <span>Аналитика<br>по финансам</span>
                            </button>
                        </div>
                        <span class="ribbon-group-label">Финансы</span>
                    </div>
                    <div class="ribbon-separator"></div>
                    <div class="ribbon-group">
                        <div class="ribbon-group-content row">
                            <button id="ribbon-resource-analytics" class="ribbon-btn analysis-view" data-view="resource-analytics">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                                <span>Аналитика<br>по ресурсам</span>
                            </button>
                        </div>
                        <span class="ribbon-group-label">Ресурсы</span>
                    </div>
                </div>

                <!-- Budget Ribbon Panel -->
                <div class="ribbon-panel" data-panel="budget">
                    <div class="ribbon-group">
                        <div class="ribbon-group-content">
                            <button id="ribbon-add-stage" class="ribbon-btn large">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
                                <span>Добавить<br>этап</span>
                            </button>
                        </div>
                        <span class="ribbon-group-label">Этапы</span>
                    </div>
                </div>

                <!-- Finances Ribbon Panel -->
                <div class="ribbon-panel" data-panel="finances">
                    <div class="ribbon-group">
                        <div class="ribbon-group-content row">
                            <button class="ribbon-btn finances-subtab large active" data-subtab="income">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                                <span>Приход</span>
                            </button>
                            <button class="ribbon-btn finances-subtab large" data-subtab="expense">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 12h20M12 2v20"/><path d="m16 8-4 4-4-4"/></svg>
                                <span>Расход</span>
                            </button>
                        </div>
                        <span class="ribbon-group-label">Раздел</span>
                    </div>
                    <div class="ribbon-separator"></div>
                    <div class="ribbon-group">
                        <div class="ribbon-group-content">
                            <button id="ribbon-add-finance" class="ribbon-btn large">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
                                <span>Добавить</span>
                            </button>
                        </div>
                        <span class="ribbon-group-label">Создание</span>
                    </div>
                </div>

                <!-- GPR Ribbon Panel (empty for now) -->
                <div class="ribbon-panel" data-panel="gpr">
                    <div class="ribbon-group">
                        <div class="ribbon-group-content">
                            <span class="ribbon-placeholder">ГПР — в разработке</span>
                        </div>
                    </div>
                </div>

                <!-- SMR Ribbon Panel (empty for now) -->
                <div class="ribbon-panel" data-panel="smr">
                    <div class="ribbon-group">
                        <div class="ribbon-group-content">
                            <span class="ribbon-placeholder">СМР — в разработке</span>
                        </div>
                    </div>
                </div>

                <!-- Settings Ribbon Panel (empty for now) -->
                <div class="ribbon-panel" data-panel="settings">
                    <div class="ribbon-group">
                        <div class="ribbon-group-content">
                            <span class="ribbon-placeholder">Настройки — в разработке</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Area (keep existing tab-content) -->
        <div id="tab-analysis" class="tab-content" style="display:none;">
            <div class="tab-actions">
                <button class="icon-btn" id="download-analysis" title="Скачать">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#0057d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-file-down-icon lucide-file-down">
                        <path
                            d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z" />
                        <path d="M14 2v5a1 1 0 0 0 1 1h5" />
                        <path d="M12 18v-6" />
                        <path d="m9 15 3 3 3-3" />
                    </svg>
                </button>
            </div>
            <div id="analysis-container"></div>
        </div>
        <div id="tab-income" class="tab-content" style="display:none;">
            <div class="tab-actions">
                <button class="icon-btn" id="add-income" title="Добавить">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="9" stroke="#0057d8" stroke-width="2" />
                        <path d="M10 6v8M6 10h8" stroke="#0057d8" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
                <button class="icon-btn" id="download-income" title="Скачать">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#0057d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-file-down-icon lucide-file-down">
                        <path
                            d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z" />
                        <path d="M14 2v5a1 1 0 0 0 1 1h5" />
                        <path d="M12 18v-6" />
                        <path d="m9 15 3 3 3-3" />
                    </svg>
                </button>
            </div>
            <div class="income-table-wrap">
                <table class="income-table">
                    <thead>
                        <tr>
                            <th>№</th>
                            <th>Дата</th>
                            <th>Фото</th>
                            <th>Тип операции</th>
                            <th>Из объекта</th>
                            <th>Сумма</th>
                            <th>Валюта</th>
                            <th>Кто передал</th>
                            <th>Кто получил</th>
                            <th>Комментарии</th>
                            <th style="width:70px;"></th>
                        </tr>
                    </thead>
                    <tbody id="income-tbody">
                        <!-- Строки будут добавляться динамически -->
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="5" style="text-align:right;font-weight:600;">Итого:</td>
                            <td id="income-total" style="font-weight:600;">0</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td colspan="4">&nbsp;</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- Модальное окно для добавления прихода -->
        <!-- Enhanced Income Modal - Replace lines 105-122 in index.html -->
        <div id="income-modal" class="modal" style="display:none;">
            <div class="modal-content income-modal-enhanced">
                <span class="modal-close" id="income-modal-close">&times;</span>
                <h3>Добавить приход</h3>
                <form id="income-form" class="income-form-grid">
                    <!-- Row 1: Date and Operation Type -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Дата</label>
                            <input type="date" id="income-date" required>
                        </div>
                        <div class="form-group">
                            <label>Тип операции</label>
                            <select id="income-operation-type" required>
                                <option value="income">Приход</option>
                                <option value="debt">Долг из другого объекта</option>
                                <option value="return">Возврат</option>
                            </select>
                        </div>
                    </div>

                    <!-- Row 1.5: Source Object (only for debt type) -->
                    <div class="form-row" id="source-object-row" style="display:none;">
                        <div class="form-group full-width">
                            <label>Объект-источник</label>
                            <select id="income-source-object">
                                <option value="">Выберите объект</option>
                                <!-- Objects will be populated dynamically -->
                            </select>
                        </div>
                    </div>

                    <!-- Row 2: Photo Preview -->
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>Фото</label>
                            <div class="photo-upload-area">
                                <input type="file" id="income-photo" accept="image/*" style="display:none;">
                                <div class="photo-preview-box" id="income-photo-preview">
                                    <button type="button" class="photo-upload-btn" id="income-photo-upload-btn">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                                            <circle cx="8.5" cy="8.5" r="1.5" />
                                            <polyline points="21 15 16 10 5 21" />
                                        </svg>
                                        <span>Выбрать фото</span>
                                    </button>
                                    <div class="photo-preview-container" style="display:none;">
                                        <img id="income-photo-img" src="" alt="Preview">
                                        <button type="button" class="photo-delete-btn" id="income-photo-delete-btn">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <line x1="18" y1="6" x2="6" y2="18" />
                                                <line x1="6" y1="6" x2="18" y2="18" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Row 3: Amount and Currency -->
                    <div class="form-row">
                        <div class="form-group flex-2">
                            <label>Сумма</label>
                            <input type="text" id="income-amount" required placeholder="0">
                        </div>
                        <div class="form-group flex-1">
                            <label>Валюта</label>
                            <select id="income-currency" required>
                                <option value="UZS" selected>UZS</option>
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                                <option value="RUB">RUB</option>
                                <option value="CNY">CNY</option>
                            </select>
                        </div>
                    </div>

                    <!-- Row 4: From and To -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Кто передал</label>
                            <input type="text" id="income-from" required>
                        </div>
                        <div class="form-group">
                            <label>Кто получил</label>
                            <input type="text" id="income-to" required>
                        </div>
                    </div>

                    <!-- Row 5: Comments -->
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>Комментарии</label>
                            <textarea id="income-comment" rows="3"></textarea>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn-submit">Сохранить</button>
                </form>
                <input type="hidden" id="income-edit-index">
            </div>
        </div>

        <div id="tab-budget" class="tab-content" style="display:none;">
            <div class="tab-actions">
                <button class="icon-btn" id="add-budget-group" title="Добавить этап">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#0057d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-folder-down-icon lucide-folder-down">
                        <path
                            d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z" />
                        <path d="M12 10v6" />
                        <path d="m15 13-3 3-3-3" />
                    </svg>
                </button>
                <button class="icon-btn" id="download-budget" title="Скачать">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#0057d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-file-down-icon lucide-file-down">
                        <path
                            d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z" />
                        <path d="M14 2v5a1 1 0 0 0 1 1h5" />
                        <path d="M12 18v-6" />
                        <path d="m9 15 3 3 3-3" />
                    </svg>
                </button>
            </div>
            <div id="budget-container"></div>
        </div>

        <div id="tab-expense" class="tab-content" style="display:none;">
            <div class="tab-actions">
                <button class="icon-btn" id="download-expense" title="Скачать">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#0057d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-file-down-icon lucide-file-down">
                        <path
                            d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z" />
                        <path d="M14 2v5a1 1 0 0 0 1 1h5" />
                        <path d="M12 18v-6" />
                        <path d="m9 15 3 3 3-3" />
                    </svg>
                </button>
            </div>
            <div id="expense-container"></div>
        </div>
    </div>
    <button id="sidebar-close" class="sidebar-close" style="display:none;">✕</button>

    <!-- Модалка для просмотра фото -->
    <div id="photo-modal" class="modal" style="display:none;">
        <div class="modal-content"
            style="max-width:90vw;max-height:90vh;display:flex;flex-direction:column;align-items:center;">
            <span class="modal-close" id="photo-modal-close">&times;</span>
            <img id="photo-modal-img" src=""
                style="max-width:80vw;max-height:70vh;border-radius:10px;box-shadow:0 2px 16px #0002;" alt="Фото">
        </div>
    </div>

    <script src="app.js"></script>
    <script src="budget.js"></script>
    <script src="expense.js"></script>
    <script src="analysis.js"></script>
</body>

</html>