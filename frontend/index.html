<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyBuilding — Объекты</title>
    <link rel="icon" href="assets/design_key.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="budget.css">
    <link rel="stylesheet" href="expense.css">
    <link rel="stylesheet" href="analysis.css">
    <link rel="stylesheet" href="income_modal.css">
    <link rel="stylesheet" href="income_table_buttons.css">
</head>

<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img id="sidebar-logo" src="assets/design_key.png" alt="logo" style="display:none;" />
            <span>Мои объекты</span>
            <button id="add-object">+</button>
        </div>
        <ul id="object-list" class="object-list"></ul>
    </div>
    <div class="main-content">
        <!-- Four-level navbar: top selection, main tabs, sub-tabs, actions -->
        <div class="four-level-navbar">
            <div class="level-1">
                <div class="level1-left">
                    <button id="sidebar-toggle" class="sidebar-toggle">☰</button>
                    <button id="object-select" class="object-select-btn"><span class="caret">▾</span> <span id="selected-object-name">Выбор объекта</span></button>
                </div>
                <div class="level1-right">
                    <div class="search-and-add">
                        <input id="object-search" class="object-search" type="search" placeholder="Поиск..." />
                        <button id="top-add-object" class="add-obj-square" title="Добавить объект">+
                        </button>
                    </div>
                </div>
            </div>

            <div class="level-2">
                <nav class="main-tabs">
                    <button class="main-tab" data-main="analysis">Аналитика</button>
                    <button class="main-tab" data-main="finances">Финансы</button>
                    <button class="main-tab" data-main="budget">Смета</button>
                </nav>
            </div>

            <div class="level-3">
                <nav class="sub-tabs" id="sub-tabs">
                    <button class="tab-btn" data-tab="income">Приход</button>
                    <button class="tab-btn" data-tab="expense">Расход</button>
                    <button class="tab-btn" data-tab="budget">Бюджет</button>
                </nav>
            </div>

            <div class="level-4">
                <div class="actions-row">
                    <button id="print-btn" class="icon-btn" title="Печать">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9V2h12v7" /><rect x="6" y="13" width="12" height="8" rx="2"/></svg>
                    </button>
                    <button id="add-stage-btn" class="icon-btn" title="Добавить этап">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7v10a2 2 0 0 0 2 2h14V7H3z" /><path d="M9 3v4" /><path d="M12 5h6" /></svg>
                    </button>
                    <button id="add-action-btn" class="icon-btn" title="Добавить">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14" /><path d="M5 12h14" /></svg>
                    </button>
                    <!-- object-actions removed from navbar to avoid duplication; controls live inside Аналитика tab -->
                </div>
            </div>
        </div>
        <!-- Old tabs-actions-row removed — replaced by four-level-navbar above. -->
        <div id="tab-analysis" class="tab-content" style="display:none;">
            <div class="tab-actions">
                <button class="icon-btn" id="download-analysis" title="Скачать">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#0057d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-file-down-icon lucide-file-down">
                        <path
                            d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z" />
                        <path d="M14 2v5a1 1 0 0 0 1 1h5" />
                        <path d="M12 18v-6" />
                        <path d="m9 15 3 3 3-3" />
                    </svg>
                </button>
            </div>
            <div id="analysis-container"></div>
        </div>
        <div id="tab-income" class="tab-content" style="display:none;">
            <div class="tab-actions">
                <button class="icon-btn" id="add-income" title="Добавить">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="9" stroke="#0057d8" stroke-width="2" />
                        <path d="M10 6v8M6 10h8" stroke="#0057d8" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
                <button class="icon-btn" id="download-income" title="Скачать">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#0057d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-file-down-icon lucide-file-down">
                        <path
                            d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z" />
                        <path d="M14 2v5a1 1 0 0 0 1 1h5" />
                        <path d="M12 18v-6" />
                        <path d="m9 15 3 3 3-3" />
                    </svg>
                </button>
            </div>
            <div class="income-table-wrap">
                <table class="income-table">
                    <thead>
                        <tr>
                            <th>№</th>
                            <th>Дата</th>
                            <th>Фото</th>
                            <th>Тип операции</th>
                            <th>Из объекта</th>
                            <th>Сумма</th>
                            <th>Валюта</th>
                            <th>Кто передал</th>
                            <th>Кто получил</th>
                            <th>Комментарии</th>
                            <th style="width:70px;"></th>
                        </tr>
                    </thead>
                    <tbody id="income-tbody">
                        <!-- Строки будут добавляться динамически -->
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="5" style="text-align:right;font-weight:600;">Итого:</td>
                            <td id="income-total" style="font-weight:600;">0</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td colspan="4">&nbsp;</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- Модальное окно для добавления прихода -->
        <!-- Enhanced Income Modal - Replace lines 105-122 in index.html -->
        <div id="income-modal" class="modal" style="display:none;">
            <div class="modal-content income-modal-enhanced">
                <span class="modal-close" id="income-modal-close">&times;</span>
                <h3>Добавить приход</h3>
                <form id="income-form" class="income-form-grid">
                    <!-- Row 1: Date and Operation Type -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Дата</label>
                            <input type="date" id="income-date" required>
                        </div>
                        <div class="form-group">
                            <label>Тип операции</label>
                            <select id="income-operation-type" required>
                                <option value="income">Приход</option>
                                <option value="debt">Долг из другого объекта</option>
                                <option value="return">Возврат</option>
                            </select>
                        </div>
                    </div>

                    <!-- Row 1.5: Source Object (only for debt type) -->
                    <div class="form-row" id="source-object-row" style="display:none;">
                        <div class="form-group full-width">
                            <label>Объект-источник</label>
                            <select id="income-source-object">
                                <option value="">Выберите объект</option>
                                <!-- Objects will be populated dynamically -->
                            </select>
                        </div>
                    </div>

                    <!-- Row 2: Photo Preview -->
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>Фото</label>
                            <div class="photo-upload-area">
                                <input type="file" id="income-photo" accept="image/*" style="display:none;">
                                <div class="photo-preview-box" id="income-photo-preview">
                                    <button type="button" class="photo-upload-btn" id="income-photo-upload-btn">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                                            <circle cx="8.5" cy="8.5" r="1.5" />
                                            <polyline points="21 15 16 10 5 21" />
                                        </svg>
                                        <span>Выбрать фото</span>
                                    </button>
                                    <div class="photo-preview-container" style="display:none;">
                                        <img id="income-photo-img" src="" alt="Preview">
                                        <button type="button" class="photo-delete-btn" id="income-photo-delete-btn">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <line x1="18" y1="6" x2="6" y2="18" />
                                                <line x1="6" y1="6" x2="18" y2="18" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Row 3: Amount and Currency -->
                    <div class="form-row">
                        <div class="form-group flex-2">
                            <label>Сумма</label>
                            <input type="text" id="income-amount" required placeholder="0">
                        </div>
                        <div class="form-group flex-1">
                            <label>Валюта</label>
                            <select id="income-currency" required>
                                <option value="UZS" selected>UZS</option>
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                                <option value="RUB">RUB</option>
                                <option value="CNY">CNY</option>
                            </select>
                        </div>
                    </div>

                    <!-- Row 4: From and To -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Кто передал</label>
                            <input type="text" id="income-from" required>
                        </div>
                        <div class="form-group">
                            <label>Кто получил</label>
                            <input type="text" id="income-to" required>
                        </div>
                    </div>

                    <!-- Row 5: Comments -->
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>Комментарии</label>
                            <textarea id="income-comment" rows="3"></textarea>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn-submit">Сохранить</button>
                </form>
                <input type="hidden" id="income-edit-index">
            </div>
        </div>

        <div id="tab-budget" class="tab-content" style="display:none;">
            <div class="tab-actions">
                <button class="icon-btn" id="add-budget-group" title="Добавить этап">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#0057d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-folder-down-icon lucide-folder-down">
                        <path
                            d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z" />
                        <path d="M12 10v6" />
                        <path d="m15 13-3 3-3-3" />
                    </svg>
                </button>
                <button class="icon-btn" id="download-budget" title="Скачать">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#0057d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-file-down-icon lucide-file-down">
                        <path
                            d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z" />
                        <path d="M14 2v5a1 1 0 0 0 1 1h5" />
                        <path d="M12 18v-6" />
                        <path d="m9 15 3 3 3-3" />
                    </svg>
                </button>
            </div>
            <div id="budget-container"></div>
        </div>

        <div id="tab-expense" class="tab-content" style="display:none;">
            <div class="tab-actions">
                <button class="icon-btn" id="download-expense" title="Скачать">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#0057d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-file-down-icon lucide-file-down">
                        <path
                            d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z" />
                        <path d="M14 2v5a1 1 0 0 0 1 1h5" />
                        <path d="M12 18v-6" />
                        <path d="m9 15 3 3 3-3" />
                    </svg>
                </button>
            </div>
            <div id="expense-container"></div>
        </div>
    </div>
    <button id="sidebar-close" class="sidebar-close" style="display:none;">✕</button>

    <!-- Модалка для просмотра фото -->
    <div id="photo-modal" class="modal" style="display:none;">
        <div class="modal-content"
            style="max-width:90vw;max-height:90vh;display:flex;flex-direction:column;align-items:center;">
            <span class="modal-close" id="photo-modal-close">&times;</span>
            <img id="photo-modal-img" src=""
                style="max-width:80vw;max-height:70vh;border-radius:10px;box-shadow:0 2px 16px #0002;" alt="Фото">
        </div>
    </div>

    <script src="app.js"></script>
    <script src="budget.js"></script>
    <script src="expense.js"></script>
    <script src="analysis.js"></script>
</body>

</html>